/*
 * sountTest.c
 *
 *  Created on: Oct 21, 2016
 *      Author: superman
 */
#include "sound_control.h"
#include "xparameters.h"
#include "xac97_l.h"
#include <stdio.h>

void sound_interrupt_handler() {
	xil_printf("Sound Interrupt received\n\r");
	load_sound_buffer();
	sound_control_load_sound();
}

void interrupt_handler_dispatcher(void* ptr) {
	int intc_status = XIntc_GetIntrStatus(XPAR_INTC_0_BASEADDR);
	// Check the sound controller.
	if (intc_status & XPAR_AXI_AC97_0_INTERRUPT_MASK){
		XIntc_AckIntr(XPAR_INTC_0_BASEADDR, XPAR_AXI_AC97_0_INTERRUPT_MASK);
		sound_interrupt_handler();
	}
}

int main() {
	sound_control_init();
	while(1) {
		sound_control_simple_test();
//		if (XAC97_isInFIFOEmpty(XPAR_AXI_AC97_0_BASEADDR)) {
//			load_sound_buffer();
//			sound_control_load_sound();
//		}
	}
}
